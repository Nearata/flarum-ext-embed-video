(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const o=flarum.core.compat["common/extend"],r=flarum.core.compat["common/components/Tooltip"];var n=t.n(r);const a=flarum.core.compat["forum/components/Button"];var i=t.n(a);const l=flarum.core.compat["forum/components/CommentPost"];var u=t.n(l);const s=flarum.core.compat["forum/components/TextEditor"];var d=t.n(s),c={url:"https://cdnjs.cloudflare.com/ajax/libs/dplayer/1.26.0/DPlayer.min.js",integrity:"sha512-1t2U1/0xGhBZAriD+/9llOhjPs5nFBDZ7KbnHB4SGwAUPrzyS+02Kus1cz0exk5eMyXxwfHxj/1JLuie/p6xXA==",loaded:!1},p=[{attributeName:"Dash",url:"https://cdnjs.cloudflare.com/ajax/libs/dashjs/4.4.1/dash.all.min.js",integrity:"sha512-WHtkQz1iePtUjmTfBntzMsr+u7Gn94FklVz/nWz5ueOHutXzsRnbU4BsAmpizvysAqdPU1tMRYn7JdJgdyVuaQ==",loaded:!1,window:window.dashjs},{attributeName:"Flv",url:"https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.6.2/flv.min.js",integrity:"sha512-49OFf+8jaHx4Vb7iFNb46Loq1pIxXlEYeVOQRIx0KLBRF4KSV6E7QK2Vw5r416TQDyBJW+DFh2CyTV7+gCWd6g==",loaded:!1,window:window.FlvJs},{attributeName:"Hls",url:"https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.2.0/hls.min.js",integrity:"sha512-hN4vMZkhrNp3J1cL4ADv9uBTWr9h4uxfcHoodvGEQfU5K5qhH5P3j08rlBshrZAd1M9aY8MtITcT8z/WUvRQAw==",loaded:!1,window:window.Hls},{attributeName:"Shaka",url:"https://cdnjs.cloudflare.com/ajax/libs/mux.js/6.2.0/mux.min.js",integrity:"sha512-9VtQ5XTyfOzaheGDZDiyJJQAbo3LRtaguZtl31k130VPr2OII5Ql98R/PV0hrMvJ8dpYS4e62RigbTTrNWsbfA==",loaded:!1,window:window.muxjs},{attributeName:"Shaka",url:"https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.1.2/shaka-player.compiled.js",integrity:"sha512-i6QxTQpZ7bNwEcH5jqA4csLYT3nk43xka8bozkqAakcbibDP+bMwVX8+Rjz2hwG3ahoGrPbE+D4rZ8xJX2OosA==",loaded:!1,window:window.shaka},{attributeName:"WebTorrent",url:"https://cdnjs.cloudflare.com/ajax/libs/webtorrent/1.8.26/webtorrent.min.js",integrity:"sha512-J8zHf3iLK7ukV6BqbFTVQMw6b/eua5odWwvZj+QRoSZKUdMZlYNOyVznYqz8sUqJa99sfKoCAmHxSVsyjPl8ww==",loaded:!1,window:window.WebTorrent}];function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}const b=flarum.core.compat["common/components/Button"];var h=t.n(b);const y=flarum.core.compat["common/components/Modal"];var v=t.n(y);const w=flarum.core.compat["common/components/Select"];var g=t.n(w);const j=flarum.core.compat["common/components/Switch"];var x=t.n(j),P=function(t){return app.translator.trans("nearata-embed-video.forum.modal."+t)},S=function(t){var e,o;function r(){return t.apply(this,arguments)||this}o=t,(e=r).prototype=Object.create(o.prototype),e.prototype.constructor=e,f(e,o);var n=r.prototype;return n.oninit=function(e){var o=this;t.prototype.oninit.call(this,e),this.videoUrl="",this.videoType="normal",this.isLive=!1,this.videoOptions={normal:P("video_types.normal")},p.forEach((function(t){if(app.forum.attribute("embedVideo"+t.attributeName)){var e=t.attributeName.toLowerCase();o.videoOptions[e]=P("video_types."+e)}}))},n.className=function(){return"EmbedVideoModal Modal--small"},n.title=function(){return P("title")},n.content=function(){var t=this;return[m(".Modal-body",[m(".Form",[m(".Form-group",[m("label",P("video_url_label")),m("input",{type:"name",name:"url",class:"FormControl",disabled:this.disabled,oninput:function(e){return t.videoUrl=e.target.value},autocomplete:"off",placeholder:P("video_url_placeholder")})]),m(".Form-group",[m("label",P("video_type_label")),m(g(),{options:this.videoOptions,value:this.videoType,onchange:function(e){return t.videoType=e}})]),m(".Form-group",[m(x(),{onchange:function(e){return t.isLive=e},state:this.isLive},P("live_mode"))]),app.forum.attribute("embedVideoQualitySwitching")?m(".Form-group",[m("a",{class:"Button Button--primary",href:"https://github.com/Nearata/flarum-ext-embed-video/blob/master/QUALITY_SWITCHING.md",target:"_blank"},"Quality Switching tutorial")]):null,m(".Form-group",[m(h(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading},P("submit_button"))])])]),m(".Modal-footer",[m("span",["Powered by ",m("a",{href:"https://github.com/DIYgod/DPlayer",target:"_blank"},"DPlayer")])])]},n.onsubmit=function(t){t.preventDefault();var e=window.crypto.getRandomValues(new Uint16Array(1))[0];this.attrs.editor.insertAtCursor('[embed-video id="'+e+'" url="'+this.videoUrl+'" type="'+this.videoType+'" live="'+this.isLive+'"]'),this.hide()},r}(v());function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}var T=function(t){return new Promise((function(e){var o=document.createElement("script");o.src=t.url,t.integrity&&(o.integrity=t.integrity,o.crossOrigin="anonymous"),o.async=!0,o.onload=e,document.body.appendChild(o)}))};app.initializers.add("nearata-embed-video",(function(){(0,o.extend)(d().prototype,"controlItems",(function(t){if(app.forum.attribute("embedVideoCreate")){var e=this.attrs.composer.editor;t.add("nearataEmbedVideo",m(n(),{text:app.translator.trans("nearata-embed-video.forum.button_tooltip_title")},[m(i(),{icon:"fas fa-cat",class:"Button Button--icon",onclick:function(){return app.modal.show(S,{editor:e})}})]))}})),(0,o.extend)(u().prototype,"oncreate",(function(){var t=this.element.querySelectorAll(".dplayer-container");t.length&&new Promise((function(t){p.forEach((function(t){if(t.loaded)var e=setInterval((function(){t.window&&clearInterval(e)}),1e3);app.forum.attribute("embedVideo"+t.attributeName)&&!t.loaded&&(t.loaded=!0,T(t))})),t()})).then((function(){return new Promise((function(t){if(c.loaded)var e=setInterval((function(){window.DPlayer&&(clearInterval(e),t())}),1e3);else c.loaded=!0,T(c).then((function(){return t()}))})).then((function(){return function(t){for(var e,o=function(){var t=e.value,o=t.dataset.url,r=t.dataset.type,n=t.dataset.live,a=t.dataset.qualities,i=[];a&&(o&&i.push({name:"default",url:o,type:r}),a.split(",").forEach((function(t){var e=t.split(";");i.push({name:e[0],url:e[1],type:e.length<3?"auto":e[2]})})));var l=app.forum.attribute("embedVideoQualitySwitching")&&i.length>0;new DPlayer({container:t,live:"true"===n,theme:app.forum.attribute("embedVideoTheme")||"#b7daff",logo:app.forum.attribute("embedVideoLogo")||"",lang:app.forum.attribute("embedVideoLang")||"",airplay:app.forum.attribute("embedVideoAirplay")||!1,hotkey:app.forum.attribute("embedVideoHotkey")||!1,video:l?{quality:i,defaultQuality:0}:{url:o,type:r,customType:{dash:function(t,e){window.dashjs.MediaPlayer().create().initialize(t,t.src,!1)},shaka:function(t){function e(e,o){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e){shaka.Player.isBrowserSupported()?new shaka.Player(t).load(t.src).then((function(){})).catch((function(t){return console.error(t)})):console.error("Error: Shaka is not supported.")}))}}})},r=function(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=function(t,e){if(t){if("string"==typeof t)return V(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?V(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(e=r()).done;)o()}(t)}))}))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map